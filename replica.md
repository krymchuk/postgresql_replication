# Реплікація та шардування баз даних

Так як в лекції використовувалась база MySQL і щоб повністю покроково не повторяти кроки по виконанню з лекції, я вирішив використати базу даних PostgreSQL, попередньо створивши два EC2 інстанса з проінстальованими на запущеними postgresql базами даних.

## Створення бази даних і таблиць:
Створили базу даних Store.

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.001.png)

Наповнили базу даних таблицями з даними 

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.002.png)



## Конфігурація основного сервера (master):

Створюємо обліковий запис користувача для реплікації

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.003.png)

Вказуємо приватну IP адресу сервера master бази в файлі конфігурації postgresql.conf

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.004.png)

Вмикаємо логування

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.005.png)

Додаємо запис про користувача з правами на реплікацію у файлі pg\_hba.conf

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.006.png)


## Налаштування вторинного сервера (slave):

Зупиняємо і очищаємо базу postgress на slave сервері для того щоб підготувати для синізації з master базою

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.007.png)

## З'єднання slave з master:

Виконуємо команду копіювання даних дампу бази на сервер репліки

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.008.png)

## Перевірка статусу реплікації:

Перевіряємо на мастер сервері чи репліка працює отримавши дані з таблиці pg\_stat\_replication

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.009.png)

Також на стороні репліки отримуєму дані про мастер базу з таблиці pg\_stat\_wal\_receiver;

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.010.png)

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.011.png)

Додаємо новий запис в мастер базу

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.012.png)

Бачимо що запис також є в репліці, отже наші бази даних синхронізуються.

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.013.png)

## Симуляція збою мастера: 

При відключеному мастер сервері бачимо що репліка працює як і до цього, є доступ до бази.

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.014.png)

Після увімкнення мастер сервера, робимо зміни до бази і перевіряємо чи є синхронізація з реплікою.  Добавляємо ще один рядок до таблиці Products з мастера і бачимо що новий рядок також зʼявився в репліці, отже синхронізація працює.

![](Aspose.Words.4634bc70-f2a1-4691-a6d9-939d4a92fd57.015.png)
